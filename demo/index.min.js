!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Ornament={})}(this,(function(t){"use strict";function e(t,e){if("object"!=typeof t)throw new TypeError(`Expected "${e}" to be an object, got ${typeof t}`);if(null===t)throw new TypeError(`Expected "${e}" to be an object, got null`)}function n(t,e,...n){for(const e of n)if("null"===e&&null===t||typeof t===e)return;throw new TypeError(`Expected "${e}" to "${n.join("/")}" but got ${typeof t}`)}function i(t,e,...n){for(const i of n)if("null"===i&&null===t[e]||typeof t[e]===i)return;throw new TypeError(`Expected "${e}" to be "${n.join("/")}" but got ${typeof t[e]}`)}function r(t){e(t,"transformer"),i(t,"parse","function"),i(t,"validate","function"),i(t,"validate","function"),i(t,"updateAttrPredicate","function","undefined"),i(t,"beforeInitCallback","function","undefined"),i(t,"beforeSetCallback","function","undefined")}function o(t,e,n,i={}){const r=Array.isArray(n)?n:[n];if(!r.includes(t.kind)){const n=r.map((t=>t.slice(0,1).toUpperCase()+t.slice(1))).join("/");throw new TypeError(`${n} decorator ${e} used on ${t.kind}`)}if("class"!==n){if(t.private&&!0!==i.private)throw new TypeError(`Decorator ${e} can't be used on private members`);if(t.static&&!0!==i.static)throw new TypeError(`Decorator ${e} can't be used on static members`)}}const s=new Set,a=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,f=new WeakSet,h=new WeakMap;class d extends Event{constructor(t){super("__ornament-reactivity"),this.key=t}}const p=new FinalizationRegistry((t=>t()));function b(t,e){const n=new WeakMap;function i(...i){const r=n.get(this);r&&r(),n.set(this,e((()=>{t.call(this,...i),n.delete(this)})))}return h.set(i,t),i}function g(t={}){const e=t.fn??g.raf();return function(t,n){if(o(n,"@debounce",["field","method"],{private:!0,static:!0}),"field"===n.kind)return function(t){if("function"!=typeof t)throw new TypeError("@debounce() can only be applied to function class fields");return b(t,e).bind(this)};if("method"===n.kind){if(void 0===t)throw new Error("This should never happen");return b(t,e)}throw new TypeError}}function m(t,e){return t===e}g.asap=function(){return function(t){let e=!1;return Promise.resolve().then((()=>{e||t()})),()=>{e=!0}}},g.raf=function(){return function(t){const e=requestAnimationFrame(t);return()=>cancelAnimationFrame(e)}},g.timeout=function(t){return function(e){const n=setTimeout(e,t);return()=>clearTimeout(n)}};const y=String;t.assertContext=o,t.assertPropType=i,t.assertRecord=e,t.assertTransformer=r,t.assertType=n,t.attr=function(t,e={}){const n=t.get??(t=>t),i=!1!==e.reflective,r=t.updateAttrPredicate??(()=>!0);return function({get:c,set:l},u){if(o(u,"@attr","accessor"),"symbol"==typeof u.name)throw new TypeError("Attribute backends for @attr must not be symbols");const f=e.as??u.name;return i&&s.add(f),i&&u.addInitializer((function(){const e=function(e,n,i){if(e!==f||i===n)return;const r=c.call(this),o=t.parse.call(this,i);t.eql.call(this,r,o)||(t.beforeSetCallback?.call(this,o,i,u),l.call(this,o),this.dispatchEvent(new d(u.name)))},n=a.get(this);n?n.set(f,e):a.set(this,new Map([[f,e]]))})),{init(e){const n=this.getAttribute(f);if(null!==n){const i=t.parse.call(this,n);return t.beforeInitCallback?.call(this,i,e,u),i}const i=t.validate.call(this,e);return t.beforeInitCallback?.call(this,i,e,u),i},set(e){const n=c.call(this),o=t.validate.call(this,e);if(!t.eql.call(this,n,o)){if(t.beforeSetCallback?.call(this,o,e,u),l.call(this,o),i){const e=r.call(this,n,o);null===e?this.removeAttribute(f):!0===e&&this.setAttribute(f,t.stringify.call(this,o))}this.dispatchEvent(new d(u.name))}},get(){return n.call(this,c.call(this))}}}},t.boolean=function(){return{parse:t=>null!==t,validate:Boolean,stringify:()=>"",eql:m,updateAttrPredicate:(t,e)=>!1!==e||null}},t.connected=function(){return function(t,e){o(e,"@connected","method",{private:!0}),e.addInitializer((function(){const t=e.access.get(this),n=c.get(this);n?n.push(t.bind(this)):c.set(this,[t.bind(this)])}))}},t.debounce=g,t.define=function(t){return function(e,n){o(n,"@define","class"),n.addInitializer((function(){window.customElements.define(t,this)}));const i=e.observedAttributes??[],r=e.prototype.attributeChangedCallback,h=e.prototype.connectedCallback,d=e.prototype.disconnectedCallback,p=Object.getOwnPropertyDescriptor(e.prototype,Symbol.toStringTag);return class extends e{constructor(...t){super(...t);for(const t of u.get(this)??[])t();u.delete(this),f.add(this)}get[Symbol.toStringTag](){if(p&&p.get)return p.get.call(this);return"HTML"+this.tagName.split("-").map((t=>t.slice(0,1).toUpperCase()+t.slice(1).toLowerCase())).join("")+"Element"}static get observedAttributes(){return[...i,...s]}attributeChangedCallback(t,e,n){r&&i.includes(t)&&r.call(this,t,e,n);const o=a.get(this);if(!o)return;const s=o.get(t);s&&s.call(this,t,e,n)}connectedCallback(){h&&h.call(this);for(const t of c.get(this)??[])t()}disconnectedCallback(){d&&d.call(this);for(const t of l.get(this)??[])t()}}}},t.disconnected=function(){return function(t,e){o(e,"@disconnected","method",{private:!0}),e.addInitializer((function(){const t=e.access.get(this),n=l.get(this);n?n.push(t.bind(this)):l.set(this,[t.bind(this)])}))}},t.event=function(){const t=new WeakMap;function e(e){const n=t.get(this);if(n){!1===n.call(this,e)&&e.preventDefault()}}return{parse:t=>t&&"string"==typeof t?new Function("event",t):null,validate:t=>"function"==typeof t?t:"string"==typeof t?new Function("event",t):null,stringify(){throw new Error("This function should never be called, updating event handler properties does not change the attribute value!")},eql:m,beforeInitCallback(n,i,r){if(r.private||"symbol"==typeof r.name)throw new Error("Event handler name must be a non-private non-symbol");if(!r.name.startsWith("on"))throw new Error("Event handler name must start with 'on'");n&&(t.set(this,n),this.addEventListener(r.name.slice(2),e))},beforeSetCallback(n,i,r){if(!t.get(this)||!n){const t=r.name.slice(2);this.removeEventListener(t,e),this.addEventListener(t,e)}t.set(this,n)},updateAttrPredicate:()=>!1}},t.href=function(){const t=new WeakMap;return{parse:t=>null===t?"":String(t),validate:t=>String(t),stringify:String,eql(e,n){return!!t.get(this)&&m(e,n)},get(e){if(!t.get(this))return e;const n=document.createElement("a");return n.href=e,n.href},beforeSetCallback(e,n){const i=null!=n;t.set(this,i)}}},t.int=function(t={}){const i=new WeakMap,{min:r,max:o}=function(t){e(t,"options");const{min:i,max:r}=t;if(n(i,"min","bigint","undefined"),n(r,"max","bigint","undefined"),"bigint"==typeof i&&"bigint"==typeof r&&i>=r)throw new RangeError('Expected "min" to be be less than "max"');return{min:i,max:r}}(t);return{parse(t){if(function(t){return"string"==typeof t||"number"==typeof t||"bigint"==typeof t||"boolean"==typeof t}(t))try{const e=BigInt(t);return void 0!==r&&e<=r?r:void 0!==o&&e>=o?o:e}catch{return i.get(this)??0n}return i.get(this)??0n},validate(t){if(void 0===t)return i.get(this)??0n;const e=BigInt(t);if(void 0!==r&&e<r)throw new Error(`${e} is less than minimum value ${r}`);if(void 0!==o&&e>o)throw new Error(`${e} is greater than maximum value ${o}`);return e},stringify:y,eql:m,beforeInitCallback(t,e){"bigint"==typeof e&&i.set(this,e)}}},t.literal=function(t){const n=new WeakMap,i=function(t){e(t=t??{},"options");const{values:n,transformer:i}=t;if(r(i),!Array.isArray(n))throw new TypeError(`Expected "values" to be array, got "${typeof n}".`);if(0===n.length)throw new TypeError('Expected "values" to not be empty');return{transformer:i,values:n}}(t);return{parse(t){const e=i.transformer.parse.call(this,t);return i.values.includes(e)?e:n.get(this)??i.values[0]},validate(t){if(void 0===t)return n.get(this)??i.values[0];const e=i.transformer.validate.call(this,t);if(i.values.includes(e))return e;throw new Error(`Invalid value: ${i.transformer.stringify.call(this,e)}`)},stringify:i.transformer.stringify,eql:i.transformer.eql,beforeInitCallback(t,e){if(i.values.includes(e))return n.set(this,e)}}},t.number=function(t={}){const i=new WeakMap,{min:r,max:o}=function(t){e(t,"options");const{min:i=-1/0,max:r=1/0}=t;if(n(i,"min","number"),n(r,"max","number"),i>=r)throw new RangeError("Expected min to be be less than max");return{min:i,max:r}}(t);return{parse(t){if(null===t)return i.get(this)??0;const e=Number(t);return Number.isNaN(e)?i.get(this)??0:e<=r?r:e>=o?o:e},validate(t){if(void 0===t)return i.get(this)??0;const e=Number(t);if(Number.isNaN(e))throw new Error("Invalid number NaN");if(e<r||e>o)throw new Error(`${e} is out of range [${r}, ${o}]`);return e},stringify:String,eql:m,beforeInitCallback(t,e){"number"==typeof e&&i.set(this,e)}}},t.prop=function(t){const e=t.get??(t=>t);return function({get:n,set:i},r){return o(r,"@prop","accessor",{private:!0}),{init(e){return t.beforeInitCallback?.call(this,e,e,r),t.validate.call(this,e)},set(e){const o=n.call(this),s=t.validate.call(this,e);t.eql.call(this,o,s)||(i.call(this,s),this.dispatchEvent(new d(r.name)))},get(){return e.call(this,n.call(this))}}}},t.reactive=function(t={}){const e=t.initial??!0;return function(n,i){o(i,"@reactive","method",{private:!0}),i.addInitializer((function(){const n=i.access.get(this);if(e){const t=h.get(n)??n,e=u.get(this);e?e.push(t.bind(this)):u.set(this,[t.bind(this)])}this.addEventListener("__ornament-reactivity",(e=>{!f.has(this)||t.keys&&!t.keys.includes(e.key)||n.call(this)}))}))}},t.record=function(){const t=new WeakMap;return{parse(e){try{const n=JSON.parse(String(e));return null===n||"object"!=typeof n?t.get(this):n}catch{return t.get(this)}},validate(t){if(null===t)throw new TypeError('Expected object, got "null"');if("object"!=typeof t)throw new TypeError(`Expected object, got "${typeof t}"`);return t},stringify:JSON.stringify,eql:m,beforeInitCallback(e,n){"object"==typeof n&&null!==n&&t.set(this,n)}}},t.string=function(){const t=new WeakMap;return{parse(e){return e?String(e):t.get(this)??""},validate(e){return void 0===e?t.get(this)??"":String(e)},stringify:y,eql:m,beforeInitCallback(e,n){"string"==typeof n&&t.set(this,n)}}},t.subscribe=function(t,e,n){return function(i,r){if(o(r,"@subscribe","method",{private:!0}),("function"==typeof t||t instanceof EventTarget)&&"string"==typeof e)r.addInitializer(function(t,e,n,i=(()=>!0)){return function(){const r=t.access.get(this),o=t=>{i.call(this,t)&&r.call(this,t)};"function"==typeof e&&(e=e()),p.register(this,(()=>e.removeEventListener(n,o))),e.addEventListener(n,o)}}(r,t,e,n));else{var s;if(!(s=t)||"object"!=typeof s||!("subscribe"in s)||"function"!=typeof s.subscribe||"function"!=typeof e&&void 0!==e)throw new Error("Invalid arguments to @subscribe");r.addInitializer(function(t,e,n=(()=>!0)){return function(){const i=t.access.get(this),r=e.subscribe((()=>{n.call(this,e.value)&&i.call(this,e)}));p.register(this,r)}}(r,t,e))}}}}));
